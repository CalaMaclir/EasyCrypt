# EasyCrypt.ps1

`EasyCrypt.ps1` は、**ファイルの暗号化・復号処理**を **GUI(フォーム)** 上で簡単に行える PowerShell スクリプトです。  
同一フォルダに作成された **`keys`** ディレクトリ内で **RSA 鍵ペア（秘密鍵/公開鍵）** を管理し、  
次の操作を 1 つのフォームから実行できます。

- **鍵ペアの生成 (Generate Key)**　: RSA 鍵ペア（秘密鍵/公開鍵）を生成します
- **暗号化 (Encrypt)**　: 指定した公開鍵を使ってファイルを暗号化  
- **復号 (Decrypt)**　: 暗号ファイルに埋め込まれた Modulus を参照し、**`keys`** ディレクトリ内にある秘密鍵を自動判定して復号  

## 特徴

1. **誰でも簡単に使えるものを目指して**  
   誰でも簡単に使えるものを目指しました。  

2. **複数の公開鍵による暗号化に対応**  
   これまでは公開鍵ごとに暗号化作業が必要でしたが、公開鍵が複数であっても1ファイルで対応します
   
3. **鍵管理がシンプル**  
   - `keys` ディレクトリにある `.pubkey`（公開鍵）は GUI のリストから選択可能。
   - `keys` ディレクトリは作業ディレクトリの下に作成され使用されますので、本スクリプトのショートカットを作成して、作業ディレクトリを定義しておけば、1本のプログラムで異なる環境を作成することも可能です。
   - `.pvtkey`（秘密鍵）は画面上には表示せず、`keys`内の秘密鍵をサーチして Modulus で一致するものを自動的に使用します。
   - `keys` ディレクトリの鍵名は拡張子を変更しなければ、自由に変更していただいて構いません。
      > **Note**:  
      > `keys` ディレクトリが存在しない場合は、スクリプトを初回起動時に自動生成します。

4. **ドラッグ＆ドロップ操作**  
   - メインフォーム上の枠にファイルをドロップすると、ファイル一覧に追加。  
   - まとめて複数ファイルを暗号化・復号できます。

5. **高セキュリティ**  
   - RSA 鍵ペア（秘密鍵/公開鍵）は4096bitと最高bit数で生成し使用します。  
   - AESは256bitでこれもWindowsで最高bit数で取り扱います。

6. **高速大容量処理**  
   - 公開鍵と共通鍵のハイブリット処理で高速処理を実現します。 
   - ストリーム処理で大容量ファイルを高速で処理します。しかも、省メモリです。

## 必要環境

- Windows PowerShell 5.x もしくは PowerShell 7.x  
- Windows デスクトップ上で .NET Framework / .NET Runtime が利用可能な環境  
- GUI を表示可能な環境

## 使い方

1. **スクリプトの起動**

  `EasyCrypt.ps1` ファイルを右クリックして「PowerShell で実行」などで起動します。  
   実行すると、GUI ウィンドウがポップアップします。

2. **鍵ペアの生成 (Generate Key)**

   - フォーム右側の「Generate Key」ボタンを押すと、RSA 4096bit 鍵ペアを生成し、  
     `keys` フォルダに `YYYYMMDDHHmmss.pubkey / .pvtkey` を作成します。  
   - 公開鍵ID（日時）は自動的にコンボボックスに追加されます。

3. **暗号化 (Encrypt)**

   1. 暗号化したいファイルをフォーム上にドラッグ＆ドロップ  
      → リストボックスにファイルパスが表示されます。  
   2. 「公開鍵リスト (暗号化用)」で使用したい公開鍵を選択します。  複数の公開鍵が選択可能です。
   3. 「Encrypt (暗号化)」ボタンを押すと、選択した `.pubkey` を使ってファイルを暗号化。  
   4. 暗号化結果ファイルは、元ファイル名に `.enc` を付けて出力します。

4. **復号 (Decrypt)**

   1. `.enc` ファイル（暗号ファイル）をドラッグ＆ドロップしてリストに追加  
   2. 「Decrypt (復号)」ボタンを押すと、  
      - 先頭に書き込まれている Modulus を読み取り、`keys` 内の `.pvtkey` を総当たり検索  
      - 一致した秘密鍵で復号処理を行います。  
   3. 復号完了後、暗号化前のオリジナルファイル名で出力されます。

5. **リストクリア**

   - 「リストクリア」ボタンで、リストボックスの内容を初期化し、再度ファイルを追加できます。

## 注意点

- **秘密鍵 (.pvtkey) の保管**  
  - 第三者に漏洩すると暗号ファイルを解読される恐れがあります。  
  - 取り扱いには十分ご注意ください。

- **キーサイズやアルゴリズム**  
  - デフォルトで RSA 4096bit + AES 256bit (CBCモード) を使用しています。  

- **本スクリプトの運用**  
  - 実際に運用する際は、社内ポリシーなどに応じた運用を行ってください。

 - **実装等について**  
  - 次のリポジトリも参照してください
   https://github.com/CalaMaclir/EncryptDecryptWithPublickey

## ライセンス

- 制作者がCala Maclirであることを明記いただけることを守っていただければ、ご自由に流用いただいて構いません。
- ただし、利益を伴う利用については協議させてください。
